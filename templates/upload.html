{% extends "base.html" %}
{% block title %}Upload & Print â€” PrintQ{% endblock %}

{% block extra_css %}
<style>
    .upload-zone {
        border: 2px dashed var(--bs-border-color);
        border-radius: 14px;
        padding: 48px 20px;
        text-align: center;
        cursor: pointer;
        transition: all 0.25s;
        background: rgba(124, 111, 255, 0.02);
    }
    .upload-zone:hover,
    .upload-zone.dragover {
        border-color: var(--pq-accent);
        background: rgba(124, 111, 255, 0.06);
        box-shadow: var(--pq-glow);
    }
    .upload-zone .icon { font-size: 48px; margin-bottom: 12px; }

    .file-preview { display: none; }
    .file-preview.active { display: flex; }

    @media (max-width: 768px) {
        .upload-zone { padding: 32px 16px; }
    }
</style>
{% endblock %}

{% block content %}
<!-- Navigation -->
<ul class="nav nav-pills mb-3">
    <li class="nav-item"><a class="nav-link" href="{{ url_for('web.dashboard') }}"><i class="bi bi-grid me-1"></i>My Jobs</a></li>
    {% if is_admin %}
    <li class="nav-item"><a class="nav-link" href="{{ url_for('web.admin') }}"><i class="bi bi-gear me-1"></i>Admin</a></li>
    {% endif %}
    <li class="nav-item"><a class="nav-link active" href="{{ url_for('upload.upload_page') }}"><i class="bi bi-upload me-1"></i>Upload</a></li>
</ul>

<form method="POST" enctype="multipart/form-data" id="uploadForm">
    <!-- Drop zone -->
    <div class="upload-zone" id="dropZone" onclick="document.getElementById('fileInput').click()">
        <div class="icon"><i class="bi bi-cloud-arrow-up" style="font-size: 48px; color: var(--pq-accent);"></i></div>
        <h5>Drop file here or tap to browse</h5>
        <p class="text-body-tertiary mb-0" style="font-size: 13px;">PDF, PNG, JPG, DOCX, DOC, TXT â€” Max 50 MB</p>
    </div>

    <input type="file" id="fileInput" name="file" accept=".pdf,.png,.jpg,.jpeg,.docx,.doc,.txt" style="display:none">

    <!-- File preview -->
    <div class="file-preview card p-3 mb-3 align-items-center gap-3" id="filePreview">
        <i class="bi bi-file-earmark-text" style="font-size: 32px; color: var(--pq-accent);"></i>
        <div class="flex-grow-1">
            <div class="fw-semibold" id="fileName"></div>
            <small class="text-body-tertiary" id="fileSize"></small>
        </div>
        <button type="button" class="btn btn-outline-secondary btn-sm" onclick="clearFile()"><i class="bi bi-x-lg me-1"></i>Remove</button>
    </div>

    <!-- Print options -->
    <div class="row g-3 mb-4">
        <div class="col-6 col-md-3">
            <label class="form-label">Copies</label>
            <input type="number" name="copies" min="1" max="99" value="1" class="form-control">
        </div>
        <div class="col-6 col-md-3">
            <label class="form-label">Color</label>
            <select name="color" class="form-select">
                <option value="color">ðŸŽ¨ Color</option>
                <option value="bw">â¬› B&W</option>
            </select>
        </div>
        <div class="col-6 col-md-3">
            <label class="form-label">Page Range</label>
            <input type="text" name="page_range" placeholder="e.g. 1-5, 8" class="form-control">
        </div>
        <div class="col-6 col-md-3 d-flex align-items-end">
            <div class="form-check mb-2">
                <input type="checkbox" name="duplex" id="duplex" class="form-check-input">
                <label class="form-check-label" for="duplex" style="text-transform: none; font-size: 13px;">Double-sided</label>
            </div>
        </div>
    </div>

    <button type="submit" class="btn btn-primary w-100 py-2" id="submitBtn" disabled style="font-size: 15px;">
        <i class="bi bi-printer me-2"></i>Submit Print Job
    </button>
</form>
{% endblock %}

{% block extra_js %}
<script>
    const dropZone = document.getElementById('dropZone');
    const fileInput = document.getElementById('fileInput');
    const preview = document.getElementById('filePreview');
    const submitBtn = document.getElementById('submitBtn');

    // Drag & drop
    ['dragenter', 'dragover'].forEach(e => dropZone.addEventListener(e, (ev) => {
        ev.preventDefault(); dropZone.classList.add('dragover');
    }));
    ['dragleave', 'drop'].forEach(e => dropZone.addEventListener(e, (ev) => {
        ev.preventDefault(); dropZone.classList.remove('dragover');
    }));
    dropZone.addEventListener('drop', (e) => {
        const files = e.dataTransfer.files;
        if (files.length > 0) { fileInput.files = files; showPreview(files[0]); }
    });

    fileInput.addEventListener('change', () => {
        if (fileInput.files.length > 0) showPreview(fileInput.files[0]);
    });

    function showPreview(file) {
        document.getElementById('fileName').textContent = file.name;
        document.getElementById('fileSize').textContent = (file.size / (1024 * 1024)).toFixed(2) + ' MB';
        preview.classList.add('active');
        dropZone.style.display = 'none';
        submitBtn.disabled = false;
    }

    function clearFile() {
        fileInput.value = '';
        preview.classList.remove('active');
        dropZone.style.display = 'block';
        submitBtn.disabled = true;
    }

    document.getElementById('uploadForm').addEventListener('submit', () => {
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span> Uploading...';
    });
</script>
{% endblock %}
