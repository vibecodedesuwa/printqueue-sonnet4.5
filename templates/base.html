<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>{% block title %}Print Queue Manager{% endblock %}</title>

    <!-- PWA -->
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    <meta name="theme-color" content="#0f0f1a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="PrintQ">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='icons/icon-192.png') }}">

    <!-- Bootstrap 5.3 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           PrintQ Dark Theme â€” Bootstrap 5.3 Overrides
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        :root, [data-bs-theme="dark"] {
            --bs-body-bg: #0a0a14;
            --bs-body-color: #eaeaf2;
            --bs-secondary-bg: #12121f;
            --bs-tertiary-bg: #161625;
            --bs-border-color: rgba(124, 111, 255, 0.12);
            --bs-card-bg: #161625;
            --bs-primary-rgb: 124, 111, 255;
            --bs-success-rgb: 0, 217, 166;
            --bs-danger-rgb: 255, 71, 87;
            --bs-warning-rgb: 255, 192, 72;
            --bs-info-rgb: 124, 111, 255;

            --pq-accent: #7c6fff;
            --pq-accent-dim: rgba(124, 111, 255, 0.12);
            --pq-glass-bg: rgba(18, 18, 31, 0.85);
            --pq-glass-border: rgba(124, 111, 255, 0.12);
            --pq-text-muted: #5e5e78;
            --pq-glow: 0 0 20px rgba(124, 111, 255, 0.1);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background-image:
                radial-gradient(ellipse at 15% 50%, rgba(124,111,255,0.06) 0%, transparent 50%),
                radial-gradient(ellipse at 85% 20%, rgba(233,69,96,0.04) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 80%, rgba(0,217,166,0.03) 0%, transparent 50%);
            -webkit-font-smoothing: antialiased;
            min-height: 100vh;
            min-height: 100dvh;
        }

        /* â”€â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .pq-header {
            background: var(--pq-glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--pq-glass-border);
            border-radius: 14px;
        }
        .pq-brand {
            font-size: 20px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--pq-accent) 0%, #a78bfa 50%, #e94560 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.02em;
            text-decoration: none;
        }

        /* â”€â”€â”€ Content Card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .pq-content {
            background: var(--pq-glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--pq-glass-border);
            border-radius: 14px;
        }

        /* â”€â”€â”€ Bootstrap Overrides â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .btn { font-weight: 600; font-size: 13px; letter-spacing: 0.01em; border-radius: 8px; }
        .btn-primary { background: linear-gradient(135deg, var(--pq-accent), #6358e0); border: none; }
        .btn-primary:hover { background: linear-gradient(135deg, #8b80ff, #7268f0); transform: translateY(-1px); }
        .btn-success { background: linear-gradient(135deg, #00d9a6, #00c49a); border: none; color: #0a2620; }
        .btn-success:hover { background: linear-gradient(135deg, #00e6b0, #00d4a4); color: #0a2620; }
        .btn-danger { background: linear-gradient(135deg, #ff4757, #e84040); border: none; }
        .btn-danger:hover { background: linear-gradient(135deg, #ff5c6a, #f05050); }
        .btn-warning { background: linear-gradient(135deg, #ffc048, #f0a830); border: none; color: #2a2000; }
        .btn:active { transform: scale(0.97) !important; }

        .card { background: var(--bs-card-bg); border: 1px solid var(--bs-border-color); border-radius: 12px; }

        .table { --bs-table-bg: transparent; --bs-table-hover-bg: rgba(124,111,255,0.04); font-size: 13px; }
        .table thead th {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            color: var(--pq-text-muted);
            border-bottom-color: var(--bs-border-color);
            font-weight: 600;
        }
        .table td { border-bottom-color: rgba(255,255,255,0.03); vertical-align: middle; }

        .nav-pills { background: rgba(255,255,255,0.03); border-radius: 10px; padding: 3px; }
        .nav-pills .nav-link {
            color: var(--pq-text-muted);
            font-weight: 500;
            font-size: 13px;
            border-radius: 8px;
            padding: 8px 16px;
        }
        .nav-pills .nav-link.active {
            background: var(--bs-card-bg);
            color: var(--bs-body-color);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        .nav-pills .nav-link:not(.active):hover { color: var(--bs-body-color); }

        .badge { font-weight: 600; font-size: 11px; letter-spacing: 0.03em; }

        .form-control, .form-select {
            background: var(--bs-body-bg);
            border-color: var(--bs-border-color);
            color: var(--bs-body-color);
            border-radius: 8px;
            font-size: 14px;
        }
        .form-control:focus, .form-select:focus {
            background: var(--bs-body-bg);
            border-color: var(--pq-accent);
            box-shadow: 0 0 0 3px rgba(124,111,255,0.15);
            color: var(--bs-body-color);
        }
        .form-label { font-size: 12px; text-transform: uppercase; letter-spacing: 0.05em; color: var(--pq-text-muted); font-weight: 600; }

        /* â”€â”€â”€ Bootstrap Modal Override â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .modal-content {
            background: #1e1e32;
            border: 1px solid var(--pq-glass-border);
            border-radius: 14px;
            box-shadow: 0 24px 80px rgba(0,0,0,0.5);
        }
        .modal-header { border-bottom: 1px solid rgba(255,255,255,0.04); padding: 20px 24px 16px; }
        .modal-body { padding: 16px 24px; }
        .modal-footer { border-top: 1px solid rgba(255,255,255,0.04); padding: 16px 24px; }
        .btn-close { filter: invert(1); }

        .modal-icon {
            width: 40px; height: 40px;
            border-radius: 10px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
        }
        .modal-icon.text-danger { background: rgba(255,71,87,0.12); }
        .modal-icon.text-warning { background: rgba(255,192,72,0.12); }
        .modal-icon.text-success { background: rgba(0,217,166,0.12); }

        /* â”€â”€â”€ Bootstrap Toast Override â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .toast-container-fixed {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 11000;
        }
        .toast {
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 10px;
            font-size: 13px;
            border: 1px solid;
            box-shadow: 0 8px 32px rgba(0,0,0,0.35);
        }
        .toast.toast-success { background: rgba(0,217,166,0.15); border-color: rgba(0,217,166,0.25); color: #00d9a6; }
        .toast.toast-error { background: rgba(255,71,87,0.15); border-color: rgba(255,71,87,0.25); color: #ff4757; }
        .toast.toast-warning { background: rgba(255,192,72,0.15); border-color: rgba(255,192,72,0.25); color: #ffc048; }
        .toast.toast-info { background: rgba(124,111,255,0.15); border-color: rgba(124,111,255,0.25); color: #7c6fff; }
        .toast .toast-body { padding: 12px 16px; display: flex; align-items: center; gap: 10px; }
        .toast .btn-close { filter: none; font-size: 10px; }
        .toast-success .btn-close { color: #00d9a6; }
        .toast-error .btn-close { color: #ff4757; }

        /* â”€â”€â”€ Status Bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .status-bar {
            background: rgba(255,255,255,0.02);
            border: 1px solid rgba(255,255,255,0.04);
            border-radius: 10px;
        }
        .status-dot {
            width: 8px; height: 8px;
            border-radius: 50%;
            display: inline-block;
            flex-shrink: 0;
        }
        .status-dot.online { background: #00d9a6; box-shadow: 0 0 8px rgba(0,217,166,0.5); animation: pulse 2s infinite; }
        .status-dot.offline { background: #ff4757; box-shadow: 0 0 8px rgba(255,71,87,0.5); }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }

        /* â”€â”€â”€ Job Cards (Mobile) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .job-cards { display: none; }

        .job-card {
            background: var(--bs-card-bg);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 10px;
            border: 1px solid rgba(255,255,255,0.04);
            transition: all 0.2s;
        }
        .job-card:hover { border-color: var(--bs-border-color); background: var(--bs-tertiary-bg); }
        .job-card.unclaimed { border-color: rgba(255,192,72,0.3); background: rgba(255,192,72,0.03); }
        .job-card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px; gap: 8px; }
        .job-card-title { font-weight: 600; font-size: 14px; }
        .job-card-meta { display: grid; grid-template-columns: 1fr 1fr; gap: 4px 12px; font-size: 12px; color: var(--pq-text-muted); margin-bottom: 12px; }
        .job-card-actions { display: flex; gap: 8px; }
        .job-card-actions .btn { flex: 1; }

        /* â”€â”€â”€ Animations â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .fade-in { animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-4px); } to { opacity: 1; transform: translateY(0); } }

        .live-indicator {
            display: inline-flex; align-items: center; gap: 6px;
            font-size: 11px; font-weight: 600; color: #00d9a6;
            text-transform: uppercase; letter-spacing: 0.05em;
        }
        .live-dot {
            width: 7px; height: 7px; border-radius: 50%;
            background: #00d9a6; animation: pulse 2s infinite;
            box-shadow: 0 0 6px rgba(0,217,166,0.5);
        }

        /* â”€â”€â”€ Responsive â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        @media (max-width: 768px) {
            .pq-header { border-radius: 10px; }
            .pq-content { border-radius: 10px; }
            .table-responsive-wrapper { display: none; }
            .job-cards { display: block; }
        }

        /* â”€â”€â”€ Misc â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .count-badge {
            display: inline-flex; align-items: center; justify-content: center;
            min-width: 22px; height: 22px; border-radius: 11px;
            font-size: 11px; font-weight: 700; padding: 0 7px;
            background: var(--pq-accent); color: white; margin-left: 6px;
        }
        .empty-state { text-align: center; padding: 48px 20px; color: var(--pq-text-muted); }
        .empty-state-icon { font-size: 48px; margin-bottom: 12px; }
    </style>
    {% block extra_css %}{% endblock %}
</head>
<body>

    <!-- â•â•â• Toast Container (Bootstrap) â•â•â• -->
    <div class="toast-container-fixed" id="toastContainer"></div>

    <!-- â•â•â• Confirmation Modal (Bootstrap) â•â•â• -->
    <div class="modal fade" id="confirmModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-sm">
            <div class="modal-content">
                <div class="modal-header border-0 pb-0">
                    <div class="d-flex align-items-center gap-3">
                        <div class="modal-icon text-danger" id="confirmIcon"><i class="bi bi-exclamation-triangle-fill"></i></div>
                        <h6 class="modal-title mb-0" id="confirmTitle">Confirm</h6>
                    </div>
                </div>
                <div class="modal-body pt-2 text-secondary" id="confirmMessage">Are you sure?</div>
                <div class="modal-footer border-0 pt-0">
                    <button type="button" class="btn btn-sm btn-secondary" data-bs-dismiss="modal" id="confirmCancelBtn">Cancel</button>
                    <button type="button" class="btn btn-sm btn-danger" id="confirmOkBtn">Confirm</button>
                </div>
            </div>
        </div>
    </div>

    <div class="container py-3">
        <!-- â•â•â• Header â•â•â• -->
        <nav class="pq-header navbar px-3 mb-3">
            <a class="pq-brand navbar-brand mb-0" href="{{ url_for('web.dashboard') }}">ğŸ–¨ï¸ PrintQ</a>
            {% if user %}
            <div class="d-none d-md-flex align-items-center gap-2">
                <span class="badge bg-secondary bg-opacity-25 text-body-secondary fw-medium px-3 py-2">{{ user.name }}</span>
                <a href="{{ url_for('upload.upload_page') }}" class="btn btn-primary btn-sm"><i class="bi bi-upload me-1"></i>Upload</a>
                <a href="{{ url_for('web.logout') }}" class="btn btn-outline-secondary btn-sm">Logout</a>
            </div>
            <button class="btn btn-outline-secondary btn-sm d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#mobileMenu">
                <i class="bi bi-list fs-5"></i>
            </button>
            {% endif %}
        </nav>

        {% if user %}
        <!-- â•â•â• Mobile Offcanvas Menu â•â•â• -->
        <div class="offcanvas offcanvas-end" tabindex="-1" id="mobileMenu">
            <div class="offcanvas-header">
                <h6 class="offcanvas-title">{{ user.name }}</h6>
                <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
            </div>
            <div class="offcanvas-body d-flex flex-column gap-2">
                <a href="{{ url_for('web.dashboard') }}" class="btn btn-outline-secondary"><i class="bi bi-grid me-2"></i>Dashboard</a>
                <a href="{{ url_for('upload.upload_page') }}" class="btn btn-primary"><i class="bi bi-upload me-2"></i>Upload & Print</a>
                <hr class="my-2">
                <a href="{{ url_for('web.logout') }}" class="btn btn-outline-danger btn-sm">Logout</a>
            </div>
        </div>
        {% endif %}

        <!-- â•â•â• Flash Messages â•â•â• -->
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <div class="mb-3">
            {% for category, message in messages %}
            <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show py-2 px-3" role="alert" style="font-size: 13px; border-radius: 10px;">
                {{ message }}
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="alert" style="font-size: 10px;"></button>
            </div>
            {% endfor %}
        </div>
        {% endif %}
        {% endwith %}

        <!-- â•â•â• Content â•â•â• -->
        <div class="pq-content p-3 p-md-4">
            {% block content %}{% endblock %}
        </div>
    </div>

    <!-- Bootstrap 5.3 JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // Toast Notification System (uses Bootstrap Toast)
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        const Toast = {
            show(message, type = 'info', duration = 4000) {
                const icons = { success: 'bi-check-circle-fill', error: 'bi-x-circle-fill', warning: 'bi-exclamation-triangle-fill', info: 'bi-info-circle-fill' };
                const container = document.getElementById('toastContainer');
                const el = document.createElement('div');
                el.className = `toast toast-${type} fade show`;
                el.setAttribute('role', 'alert');
                el.innerHTML = `
                    <div class="toast-body">
                        <i class="bi ${icons[type] || icons.info}"></i>
                        <span class="flex-grow-1">${message}</span>
                        <button type="button" class="btn-close ms-2" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                `;
                container.appendChild(el);
                const bsToast = new bootstrap.Toast(el, { delay: duration, autohide: true });
                bsToast.show();
                el.addEventListener('hidden.bs.toast', () => el.remove());
                return el;
            },
            success(msg, dur) { return this.show(msg, 'success', dur); },
            error(msg, dur)   { return this.show(msg, 'error', dur || 6000); },
            warning(msg, dur) { return this.show(msg, 'warning', dur); },
            info(msg, dur)    { return this.show(msg, 'info', dur); },
        };

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // Confirmation Modal (uses Bootstrap Modal)
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function confirmAction({ title = 'Confirm', message = 'Are you sure?', confirmText = 'Confirm', cancelText = 'Cancel', type = 'danger' }) {
            return new Promise((resolve) => {
                const iconMap = { danger: 'bi-exclamation-triangle-fill', warning: 'bi-exclamation-circle-fill', success: 'bi-check-circle-fill', info: 'bi-info-circle-fill' };
                const btnMap  = { danger: 'btn-danger', warning: 'btn-warning', success: 'btn-success', info: 'btn-primary' };

                document.getElementById('confirmTitle').textContent = title;
                document.getElementById('confirmMessage').textContent = message;
                document.getElementById('confirmIcon').className = `modal-icon text-${type}`;
                document.getElementById('confirmIcon').innerHTML = `<i class="bi ${iconMap[type]}"></i>`;
                const okBtn = document.getElementById('confirmOkBtn');
                okBtn.className = `btn btn-sm ${btnMap[type]}`;
                okBtn.textContent = confirmText;
                document.getElementById('confirmCancelBtn').textContent = cancelText;

                const modal = new bootstrap.Modal(document.getElementById('confirmModal'));
                let resolved = false;

                const cleanup = () => {
                    okBtn.removeEventListener('click', onConfirm);
                    document.getElementById('confirmModal').removeEventListener('hidden.bs.modal', onHidden);
                };
                const onConfirm = () => { resolved = true; modal.hide(); cleanup(); resolve(true); };
                const onHidden = () => { if (!resolved) { cleanup(); resolve(false); } };

                okBtn.addEventListener('click', onConfirm);
                document.getElementById('confirmModal').addEventListener('hidden.bs.modal', onHidden);
                modal.show();
            });
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // Service Worker
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/static/sw.js')
                .catch(err => console.log('SW registration failed:', err));
        }
    </script>

    {% block extra_js %}{% endblock %}
</body>
</html>
